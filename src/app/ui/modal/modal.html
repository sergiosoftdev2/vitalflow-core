@if (isOpen()) {
  <!-- Backdrop -->
  <div 
    @backdropAnimation
    [class]="backdropClasses()" 
    [style.opacity]="dragOpacity()"
    [style.backdrop-filter]="'blur(' + dragBlur() + 'px)'"
    [style.transition]="isDragging() ? 'none' : 'opacity 0.3s ease-out, backdrop-filter 0.3s ease-out'"
    (click)="onClose()" 
    (touchstart)="onTouchStart($event)"
    (touchmove)="onTouchMove($event)"
    (touchend)="onTouchEnd()"
    class="fixed inset-0 z-100 bg-zinc-950/20 dark:bg-zinc-950/60 transition-all"
  ></div>

  <!-- Container -->
  <div [class]="containerClasses()" (click)="onClose()">
    
    <!-- Modal Body -->
    <div 
      @modalAnimation
      [class]="bodyClasses()" 
      [style.transform]="'translateY(' + dragY() + 'px)'"
      [style.opacity]="dragOpacity()"
      [style.transition]="isDragging() ? 'none' : 'transform 0.3s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.3s ease-out'"
      (click)="stopPropagation($event)"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd()"
    >
      <!-- Mobile Handle -->
      <div 
        class="sm:hidden flex justify-center pt-3 pb-1 cursor-grab active:cursor-grabbing"
      >
        <div class="w-10 h-1 bg-zinc-200 dark:bg-zinc-800 rounded-full"></div>
      </div>
      
      <!-- Header -->
      <header [class]="headerClasses()">
        <div class="flex flex-col gap-1">
          @if (title()) {
            <app-title [label]="title()!" size="xl" weight="semibold"></app-title>
          }
          @if (description()) {
            <p class="text-sm text-zinc-500 dark:text-zinc-400">{{ description() }}</p>
          }
        </div>
        
        <button [class]="closeBtnClasses()" (click)="onClose()" aria-label="Cerrar modal">
          <fa-icon [icon]="faTimes"></fa-icon>
        </button>
      </header>

      <!-- Content -->
      <div [class]="contentClasses()">
        <ng-content></ng-content>
      </div>

      <!-- Footer -->
      @if (primaryActionLabel() || secondaryActionLabel()) {
        <footer [class]="footerClasses()">
          @if (primaryActionLabel()) {
            <app-button 
              [label]="primaryActionLabel()!" 
              (click)="onPrimaryAction()"
              size="base"
            ></app-button>
          }
          
          @if (secondaryActionLabel()) {
            <app-button 
              [label]="secondaryActionLabel()!" 
              variant="outlined" 
              (click)="onSecondaryAction()"
              size="base"
            ></app-button>
          }
        </footer>
      }
    </div>
  </div>
}

