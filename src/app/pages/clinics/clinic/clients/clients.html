<app-page-container title="Clientes" [isFullSize]="true">

  <div class="flex justify-end gap-2 mb-4">
    <app-button 
      size="sm" 
      [label]="viewMode() === 'table' ? 'Vista Lista' : 'Vista Tabla'" 
      color="secondary" 
      [leadingIcon]="viewMode() === 'table' ? faList : faTable"
      (click)="toggleViewMode()"
    ></app-button>
  </div>

  <div class="flex-1 min-h-0 h-full pb-10">
    @if (viewMode() === 'table') {
      <app-table [data]="clients()" [columns]="columnDefs()"></app-table>
    } @else {
      <!-- Modo Lista / Cards con Virtual Scroll sincronizado con PageContainer -->
      <cdk-virtual-scroll-viewport itemSize="296" class="w-full">
        <div *cdkVirtualFor="let row of chunkedClients()" 
             class="grid gap-4 mb-4"
             [ngClass]="{
               'grid-cols-1': columnsCount() === 1,
               'grid-cols-2': columnsCount() === 2,
               'grid-cols-3': columnsCount() === 3
             }">
          @for (client of row; track client._id) {
            <div class="group bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-3xl p-5 hover:shadow-xl hover:shadow-zinc-200/50 dark:hover:shadow-black/20 transition-all duration-300 flex flex-col gap-4 relative overflow-hidden h-[280px]">
              <!-- Glass background effect -->
              <div class="absolute -top-10 -right-10 w-32 h-32 bg-green-500/5 rounded-full blur-3xl group-hover:bg-green-500/10 transition-colors"></div>
              
              <div class="flex items-start justify-between">
                <div class="flex items-center gap-4">
                  <app-avatar [src]="client.userProfile?.picture" [label]="client.firstName + ' ' + client.lastName" size="md" />
                  <div>
                    <h3 class="font-bold text-zinc-950 dark:text-zinc-50 leading-tight">{{ client.firstName }} {{ client.lastName }}</h3>
                    <p class="text-xs text-zinc-500 dark:text-zinc-400 font-medium truncate max-w-[150px]">{{ client.userEmail || 'Sin email vinculado' }}</p>
                  </div>
                </div>
                <button class="text-zinc-400 hover:text-zinc-950 dark:hover:text-white transition-colors">
                  <fa-icon [icon]="faEllipsisV"></fa-icon>
                </button>
              </div>

              <div class="grid grid-cols-1 gap-3 py-2 border-y border-zinc-100 dark:border-zinc-800/50">
                <div class="flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400">
                  <fa-icon [icon]="faPhone" class="text-green-500 text-xs"></fa-icon>
                  <span>{{ client.phone || 'No disponible' }}</span>
                </div>
                <div class="flex items-center gap-2 text-sm text-zinc-600 dark:text-zinc-400">
                  <fa-icon [icon]="faMapMarkerAlt" class="text-green-500 text-xs"></fa-icon>
                  <span class="truncate">{{ client.address || 'Sin direcci√≥n' }}</span>
                </div>
              </div>

              <div class="flex items-center justify-between mt-auto pt-2">
                <div class="px-3 py-1 bg-zinc-100 dark:bg-zinc-800 rounded-full text-[10px] font-bold uppercase tracking-wider text-zinc-500 dark:text-zinc-400">
                    Cliente Activo
                </div>
                <app-button label="Ver Perfil" variant="ghost" size="sm"></app-button>
              </div>
            </div>
          }
        </div>
      </cdk-virtual-scroll-viewport>
    }
  </div>

</app-page-container>

<ng-template #profile let-row="row">
  <div class="flex items-center gap-2">
    <app-avatar [src]="row.userProfile?.picture" [label]="row.firstName + ' ' + row.lastName" size="sm" />
    <div>
      <p class="font-semibold text-xs text-zinc-950 dark:text-zinc-50">{{ row.firstName }} {{ row.lastName }}</p>
      <p class="text-[10px] text-zinc-500 dark:text-zinc-400">{{ row.userEmail }}</p>  
    </div>
  </div>
</ng-template>